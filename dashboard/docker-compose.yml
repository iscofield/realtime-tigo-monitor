services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "3050:8000"
    env_file:
      - ./backend/.env
    environment:
      # State file paths for bootstrapping status check
      - TAPTAP_PRIMARY_STATE_FILE=/app/state/primary/taptap.state
      - TAPTAP_SECONDARY_STATE_FILE=/app/state/secondary/taptap.state
    volumes:
      - ../config/panel_mapping.json:/app/config/panel_mapping.json:ro
      - ../assets/layout.png:/app/static/layout.png:ro
      # Mount taptap state files for status checking (read-only)
      - ../tigo-mqtt/data/primary:/app/state/primary:ro
      - ../tigo-mqtt/data/secondary:/app/state/secondary:ro
    networks:
      - solar-network
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        - VITE_WS_URL=ws://localhost:3050/ws/panels
        - VITE_API_BASE=http://localhost:3050
    ports:
      - "5174:80"
    depends_on:
      - backend
    networks:
      - solar-network
    restart: unless-stopped

networks:
  solar-network:
    driver: bridge
